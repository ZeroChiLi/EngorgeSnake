C51 COMPILER V9.01   MAIN                                                                  06/06/2017 14:55:12 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\Program\Keil\C51\BIN\C51.EXE main.c LARGE BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include "MatrixLED.h"
   2          #include "Snake.h"
   3          #include "Food.h"
   4          #include "KeyboardInput.h"
   5          #include "InfraredInput.h"
   6          
   7          void StartGame(Snake * snake,Food * food);                              //初始化蛇和食物
   8          
   9          unsigned char UpdateByKeyboard(Snake * snake);                  //根据键盘输入更新
  10          
  11          unsigned char UpdateByInfrared(Snake * snake);                  //根据红外遥控输入更新
  12                                                                          
  13          void UpdateFood(Food * food);                                                   //更新食物
  14          
  15          void main(void)
  16          {                
  17   1              int startPeriod = 1000;                                 //初始周期 ，越大越慢
  18   1              int minPeriod = 500;                                            //最短周期
  19   1              int gradient = 50;                                              //难度梯度
  20   1      
  21   1              Snake snake;                                                                            //蛇对象
  22   1              Food food;                                                                                      //食物对象
  23   1      
  24   1              IrInit();                                                                                       //红瓦遥控初始化
  25   1      
  26   1              StartGame(&snake,&food);                                                        //初始化游戏成员对象
  27   1      
  28   1              while (1)
  29   1              {                       
  30   2                      InitRedMatrix();                                                                //初始化红绿点阵                                
  31   2                      InitGreenMatrix();        
  32   2      
  33   2                      //检测碰撞(包括吃食物),碰到自己返回1，如果输入到重启键，返回0
  34   2                      if (SnakeCollision(&snake, &food) || UpdateByKeyboard(&snake) == 0 || UpdateByInfrared(&snake) == 0)
  35   2                      {               
  36   3                              ShowExplode(500);               
  37   3                              StartGame(&snake,&food);
  38   3                              continue;
  39   3                      }
  40   2      
  41   2                      SnakeMove(&snake);                                                              //更新蛇位置
  42   2      
  43   2                      UpdateFood(&food);                                                              //更新食物
  44   2                                                               
  45   2                      UpdateCol();                                                                    //检查并更新每列数值
  46   2      
  47   2                      ShowMatrix(getMax(startPeriod - snake._length * gradient,minPeriod));   //显示红绿点阵，参数是周期。
  48   2              }
  49   1      }
  50          
  51          void StartGame(Snake * snake, Food * food)
  52          {
  53   1              InitSnake(snake);
  54   1              InitFood(food);
  55   1      }          
C51 COMPILER V9.01   MAIN                                                                  06/06/2017 14:55:12 PAGE 2   

  56          void UpdateFood(Food * food)
  57          {
  58   1              if (!FoodExist(food))                                                   //判断是否存在食物,没有就加啊
  59   1                      FoodsetPos(food, GetRandomFreePos());
  60   1              
  61   1              FoodShow(food);                                                         //显示食物
  62   1      }
  63          
  64          unsigned char UpdateByKeyboard(Snake * snake)
  65          {                
  66   1              unsigned char keyNum = 0;
  67   1      
  68   1          keyNum = Key_Scan();                                                                        //扫描键盘
  69   1      
  70   1              if (IsDirection(GetDirectionFromKey(keyNum)))                   //判断是否为方向
  71   1                      SnakeSetDir(snake, GetDirectionFromKey(keyNum));
  72   1      
  73   1              if (OnClickRestartKey(keyNum))                                                  //按了key1就是重启游戏
  74   1                      return 0;
  75   1              return 1;
  76   1      }
  77          
  78          
  79          unsigned char UpdateByInfrared(Snake * snake)
  80          {
  81   1          unsigned char currentValue = 0;
  82   1      
  83   1              currentValue = GetCurrentKey();
  84   1                                
  85   1              if (IsDirection(GetDirectionFromControlValue(currentValue)))
  86   1                      SnakeSetDir(snake, GetDirectionFromControlValue(currentValue));
  87   1      
  88   1              if (OnClickPowerControlKey(currentValue))
  89   1                      return 0;
  90   1              return 1;
  91   1      }
  92          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    407    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----     156
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
